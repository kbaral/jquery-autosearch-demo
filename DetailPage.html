<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>Detail Page</title>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="css/style.css">
<link type="text/css" href="css/jquery-ui.css" rel="stylesheet" />
<link type="text/css" href="css/alpaca.min.css" rel="stylesheet" />


<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script> 
<script type="text/javascript" src="js/jquery-ui.js"></script> 
<script type="text/javascript" src="js/handlebars.min.js"></script> 
<script type="text/javascript" src="js/alpaca.min.js"></script> 
<script type="text/javascript" src="js/bootstrap.min.js"></script> 
<script type="text/javascript" src="js/script.js"></script> 
<script type="text/javascript" src="js/common.js"></script> 

</head>
<body>
<header>
  <div class="header_section clearfix">
    <div class="left_section"> 
      <!-- <div id="hamburger" class=""> <span></span> <span></span> <span></span> </div> -->
      <div class="BILogo"> <a href="javascript:;"> <img src="images/BILogo.png" alt=""> </a> </div>
      <div class="topNavigation topnav-header" id="topnav-header">BI Service Catalog (Beta)</div>
    </div>
    <div class="right_section">
      <div class="topRightLinks"> 
        <!-- <div class="searchIcon"> <a href="javascript:" class="showSearch" id="searchTab"> <img src="images/Search.png"> </a> </div>
	          <div id="searchMenu">
	            <div class="search arrow_box">
	              <input type="textbox" value="" name="searchtxt" placeholder="Search Reports">
	              <input type="button" value="GO" class="gobtn">
	            </div>
	          </div> -->
        <div class="help_popup">
          <ul class="clear-padding">
            <li class="helpPopUpHeader">Reference</li>
            <li class="catalog"><a href="javascript:;">Catalog</a> </li>
            <li class="glossary"><a href="javascript:;">Glossary</a> </li>
            <hr class="margin-topbottom-6">
            <li class="helpPopUpHeader">Video Tutorial</li>
            <li class="video"><a href="javascript:;">Dashboard Navigation</a> </li>
            <li class="video"><a href="javascript:;">Outliers Quick Updates</a> </li>
            <li class="video"><a href="javascript:;">WPA Tutorials</a> </li>
            <hr class="clear-margin">
            <li class="margin-topbottom-6"><a href="javascript:;">Feedback</a> </li>
          </ul>
        </div>
        <div class="userInfo" id="userInfo" data-original-title="" title=""><span class="welcometxt">Welcome, <br>
          <span class="user-name" id="userName"></span></span><img src="images/user.png" width="42" height="42" alt="User" class="userImg" id="userImg"> </div>
      </div>
    </div>
  </div>
  <div class="menu_section clearfix">
  <ul class="submenu clearfix">
    <li><a href="dashboard.html">BI Dashboard</a>
    <li><a href="javascript:;" onclick=window.open(CIStoolURL)>BI Service Catalog </a> </li>
    </li>
  </ul>
  <div class="cart_section"> <a href="RequestBasket.html"><img src="images/ico_cart.png" alt=""> <span class="count cartItem_count">0</span></a> </div>
</div>
</header>

<div class="container">
    <div style='padding-top: 30px; padding-left: 5px;' > 
        <div class="back_home"><a href="dashboard.html"><img src="images/ico_back.png" alt="" class="valignmid"> &nbsp;Back Home</a></div>
        <div style='padding-top: 30px; padding-left: 5px;' ></div>
        <div class="row">
            <div id = "progressbar" class="col-md-12">
              <div class="progress" id="progress-bar">               
              </div>
            <div id="progress-text"></div>
            </div> 
          
          </div>
      <div>
  <div class="request_history_container custom_width clearfix">
      
      
	  
	  <div style='padding-top: 30px; padding-left: 5px;' ></div>
	  
      <div class="request_form_section">
        <table cellpadding="0" cellspacing="0" border="0" width="100%" class="project_detail_table">
          <tbody>
            <tr>
              <td colspan="3" height="10"></td>
            </tr>
            <tr>
              <td width="40%"><p class="semi_title">PROJECT NAME</p>
                <p id="project_name"><!-- Data Mart &amp; Analytics for Finanical Inst (FIDAT) --></p></td>
              <td width="30%"><p class="semi_title">Unit</p>
                <p id="unit_name"><!-- WFA, ITSFI --></p></td>
              <td><p class="semi_title">REQUESTER</p>
                <p  id="requestor_name"></p></td>
            </tr>
            <tr>
              <td colspan="3" height="20"></td>
            </tr>
            <tr>
              <td><p class="semi_title" >REQUEST DATE</p>
                <p id="requested_date"><!-- 04/05/2017 --></p></td>
              <td><p class="semi_title">EXPECTED DATA THROUGHTPUT</p>
                <p id="expected_data_volume"><!-- 1 GB/Sec --></p></td>
              <td><p class="semi_title">DATA REFRESH FREQUENCY</p>
                <p id="data_refresh_frequency" ><!-- On-Demand --></p></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="clearfix"></div>
      <div class="inner_table_content noPadd">
        <div class="data_sources">
          <div class="inner_title1">DATA CART</div>
          <table class="table basket_table" cellpadding="0" cellspacing="0" width="100%" id="data_source_table">
            <thead>
              <tr>
                <th width="40%" class="paddl35">Name</th>
                <th>Policy Questions</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
      <div class="spacer20"></div>
      <p class="semi_title">PROJECT DETAILS</p>
      <p class="clr2" id="briefProjectDetail"><!-- The reporting layer (BO) sourcing data from multiple sources- oracle DB and data services from composite --></p>
      <div class="spacer20"></div>
      <p class="semi_title">USE CASE & BUSINESS VALUE</p>
      <p id="useCase"><!-- Business value: enable business users perform debt loan ratio analysis. --></p>
      <div class="spacer20"></div>
      <p class="semi_title">CURRENT PROJECT STAGE & CHALLENGES</p>
      <p id="additionalComments"><!-- Implementation in progress. Challenges: the reporting layer (BO) sourcing data from multiple sources - oracle DB and data service from composite --></p>
      <div class="spacer20"></div>
      <div class="inner_table_content noPadd hide">
        <div class="data_sources">
          <div class="inner_title1">ATTACHMENTS <img src="images/ico_attach1.png" alt="" class="valignmid"></div>
          <table class="table basket_table" cellpadding="0" cellspacing="0" width="100%">
            <tbody>
              <tr>
                <td  width="30%"><img src="images/ico_pdf.png" alt=""> Data Attributes</td>
                <td  width="40%">FIDAT-US_Integration.pdf <span class="clr3">(237 KB)</span></td>
                <td><a href="javascript:;"><img src="images/ico_download.png" alt=""></a></td>
              </tr>
              <tr>
                <td colspan="3"><div class="row_divider"></div></td>
              </tr>
              <tr>
                <td><img src="images/ico_jpg.png" alt=""> Data Flow Diagram </td>
                <td>DataFlow_Diagram.jpeg <span class="clr3">(153 KB)</span></td>
                <td><a href="javascript:;"><img src="images/ico_download.png" alt=""></a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="overlay"></div>

  <div id="popup" class="popup"> 
    <!-- <div id="form1" class="popup_dynamicform">
      <a href="#" class="close_popup"><img src="images/ico_close.png" alt=""></a>
    </div> --> 
    <a href="#" class="close_popup_form"><img src="images/ico_close.png" alt=""> </a>
    <div id="testForm"></div>
  </div>
</div>

<script type="text/javascript">
	/*str = localStorage.ObjectSelValue;
	strObject = JSON.parse(str);
	$(".cartItem_count").html(strObject.length);*/
     $('.userInfo').popover({
        trigger: "manual",
        html: true,
        placement: "bottom",
        content: function() {
            return $(".user_popup").html();
        },
        template: '<div class="popover" role="tooltip"><div class="arrow user-arrow"></div><div class="popover-content"></div></div>'
    }).click(function(e) {      
            $('.popover').popover('hide');
            $(this).popover('show');
    });
</script> 
<script type="text/javascript">
	$(document).ready(function(){
        var pathname = window.location.href;
        var item_arr = pathname.split('?');
        var item_arr_item = item_arr[1];
        //var item_arr_item = 100351;
      var URL = nodeproxyurl + "?qs=%2Fjson%2FApplication%2FBUSINESS_DIRECTORY%2FDATA_ACCESS_REQUEST%2FgetAccessRequestDetail%3FIN_REQUEST_NBR=" +item_arr_item;
      var progressurl = nodeproxyurl + "?qs=%2Fjson%2FApplication%2FBUSINESS_DIRECTORY%2FDATA_ACCESS_REQUEST%2FgetAccessApprovalStatusTrack%3FIN_REQUEST_NUMBER=" +item_arr_item;
       //var URL = hostcisurl+"/json/Application/BUSINESS_DIRECTORY/DATA_ACCESS_REQUEST/getAccessRequestDetail?IN_REQUEST_NBR="+item_arr_item;
	   //var progressurl = hostcisurl+"/json/Application/BUSINESS_DIRECTORY/DATA_ACCESS_REQUEST/getAccessApprovalStatusTrack?IN_REQUEST_NUMBER="+item_arr_item;	
       var selected_items=[];
	   var dataJSON = [],optionsJSON = [],schemaJSON =[];

        /* Requests Detail service starts */
		
		$.ajax
		({
      type: "GET",
      url: URL,
			//url: hostcisurl+"/json/Application/BUSINESS_DIRECTORY/DATA_ACCESS_REQUEST/getAccessRequestDetail",
			dataType: 'json',				
			headers: {   
			'Content-Type': 'application/json; charset=utf-8'
			},				
			
		//	data: { "IN_REQUEST_NBR" : item_arr_item }, 
			
			
			success: function (data){
				
                var project_name = data.retrieveAccessRequestDetailResponse.accessRequest.projectName;
                var unit_name = data.retrieveAccessRequestDetailResponse.accessRequest.requestingUnitName;
                var requestor_name = data.retrieveAccessRequestDetailResponse.accessRequest.requestorName;
                var requested_date = data.retrieveAccessRequestDetailResponse.accessRequest.requestedDate;
                requested_date = requested_date.substring(0,10);

                var expected_data_volume =   data.retrieveAccessRequestDetailResponse.accessRequest.expectedDataVolume;
                var data_refresh_frequency =  data.retrieveAccessRequestDetailResponse.accessRequest.dataRefreshFrequency;
                var briefProjectDetail = data.retrieveAccessRequestDetailResponse.accessRequest.briefProjectDetail;
               
                var useCase = data.retrieveAccessRequestDetailResponse.accessRequest.useCase;
                var additionalComments = data.retrieveAccessRequestDetailResponse.accessRequest.additionalComments;
                var objects_list = data.retrieveAccessRequestDetailResponse.accessRequest.objectList;
				var form_list = data.retrieveAccessRequestDetailResponse.accessRequest.formList;
                strObject = objects_list;
               var approvalStatus = '';
			   for (var i = 0; i < strObject.length; i++) {
                	//console.log(strObject[i].formID);
                    selected_items.push(strObject[i]);
					approvalStatus = '';
					if (typeof(form_list) != "undefined")
					{
						for(j=0;j< form_list.length; j++)
					{
						if(form_list[j].formID == strObject[i].formID)
						{
							if(form_list[j].approvalStatusCode == 'A')
								approvalStatus = "Approved";
							if(form_list[j].approvalStatusCode == 'R')
								approvalStatus = "Rejected";
							if(form_list[j].approvalStatusCode == 'I')
								approvalStatus = "Requested More Information";
							if(form_list[j].approvalStatusCode == 'S')
								approvalStatus = "Submitted";	
								
								dataJSON = JSON.stringify(JSON.parse(form_list[j].formDetail));
                        		optionsJSON = JSON.stringify(JSON.parse(form_list[j].optionJSON));
                        		schemaJSON = JSON.stringify(JSON.parse(form_list[j].schemaJSON));
							break;
						}
					}
                    if (i == 0 || strObject[i].formID != strObject[i - 1].formID) {
                        if (strObject[i].formID == null || strObject[i].formID == '9999.0') {
                        	approvalStatus = 'Pre-Approved'; 
                            $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td><input type="hidden" value=' + strObject[i].formID + ' /><div class="ico_folder_set clearfix"><span class="img_section"><img src="images/ico_folder.png" alt=""></span> <span>' + strObject[i].objectName + '</span></div></td><td class="text_center"><span class="text_center"><img alt="">&nbsp;&nbsp;N/A</span></td><td><span>'+approvalStatus+'</span></td></tr>');
                        } else {
                            $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td><input type="hidden" value=' + strObject[i].formID + ' /><div class="ico_folder_set clearfix"><span class="img_section"><img src="images/ico_folder.png" alt=""></span> <span>' + strObject[i].objectName + '</span></div></td><td class="text_center"><span><a href="javascript:;" id="open_popup" class="alps-form"><img src="images/ico_pdf_completed.png" alt=""></a></span><input type="hidden" id=' + strObject[i].formID + ' class="empty_validation '+ strObject[i].formID +'"/></td><td><span>'+approvalStatus+'</span></td></tr>');
                        }
                    } else {
                        if (strObject[i].formID == null || strObject[i].formID == '9999.0') {
							approvalStatus = 'Pre-Approved'; 
                            $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td><input type="hidden" value=' + strObject[i].formID + ' /><div class="ico_folder_set clearfix"><span class="img_section vhidden"><img src="images/ico_folder.png" alt=""></span> <span>' + strObject[i].objectName + '</span></div></td><td ><span class="vhidden">N/A</span></td><td><span class="vhidden">'+approvalStatus+'</span></td></tr>');
                        } else {
                            $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td><input type="hidden" value=' + strObject[i].formID + ' /><div class="ico_folder_set clearfix"><span class="img_section vhidden"><img src="images/ico_folder.png" alt=""></span> <span>' + strObject[i].objectName + '</span></div></td><td class="text_center"><span class="vhidden"><a href="javascript:;" id="open_popup" class="vhidden alps-form" ><img src="images/ico_mail.png" alt=""></a></span><input type="hidden" id=' + strObject[i].formID + ' class="empty_validation '+ strObject[i].formID +'"/></td><td><span class="vhidden">'+approvalStatus+'</span></td></tr>');
                        }

                    }
                    if (i == strObject.length - 1 || strObject[i].formID != strObject[i + 1].formID) {

                        $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td colspan="4"><div class="row_divider"></div></td></tr>');
                    }
					
					}
					else{
					//<input type="hidden" value=' + strObject[i].formID + ' /> removed by kshitiz
						approvalStatus = 'Pre-Approved';
						 $('#data_source_table').append('<tr class="' + strObject[i].objectID + '"><td><div class="ico_folder_set clearfix"><span class="img_section"><img src="images/ico_folder.png" alt=""></span> <span>' + strObject[i].objectName + '</span></div></td><td class="text_center">N/A</td><td><span>'+approvalStatus+'</span></td></tr>');
					
					}
					
                }		
			   
                
                $("#project_name").html(project_name);
                $("#unit_name").html(unit_name);
                $("#requested_date").html(requested_date);
                $("#requestor_name").html(requestor_name);
                $("#expected_data_volume").html(expected_data_volume);
                $("#data_refresh_frequency").html(data_refresh_frequency);
                $("#briefProjectDetail").html(briefProjectDetail);
                $("#useCase").html(useCase);
                $("#additionalComments").html(additionalComments);
			}
		});
		
		
		$.ajax({
            type: "GET",
            url: progressurl,
            dataType: 'json',
            headers: {
                'Content-Type': 'application/json; charset=utf-8'
            },
                           
            success: function(msg) {
								
					msg_data = msg.accessApprovalStatusTrackResponse.accessApprovalStatusTrack;	
					//var width = 0; 
					var progressdiv = $("#progress-bar"); 
          var steps = msg_data.length; 
          var whold = 100 / steps -1 ;  
					var w = 100 / steps -1;
					for(var i = 0; i < steps; i ++)
					{
						var s = '', success = ''; 					
						if(msg_data[i]['stepStatus'] == '1'){
							success = 'success';
            }
            else if(msg_data[i]['stepStatus'] == '2'){
							success = 'warning';
						}
						else{
							success='no';
						}
						var app = msg_data[i]['stepDetail'].replace(" ","");
						var actiondate = msg_data[i]['stepActionDate'];
            progressdiv.append("<div id = '"+app+"' class='"+success+"-color' style='left:" + w + "%;' ></div>");
            w = w + whold +.5 ;
          }
          
          var width = 100 / steps; 
					
					for(var i = 0; i < steps; i ++)
					{
           
						if(msg_data[i]['stepStatus'] == '1'){
							progressdiv.append("<div class='progress-bar progress-bar-success' style='width: "+width+"%'>"+msg_data[i]['stepDetail']+"</div>");
              var msgDate = msg_data[i]['stepActionDate']; 
              msgDate = msgDate.replace(' ', 'T');
              var jsonDate = new Date(msgDate); 
              
              var date = displayTime(jsonDate); 
              var st = steps + 1; 
              if(steps == 3){
                st = 4; 
              }
              if(steps == 4)
              {
                st = 3; 
              }
              if(steps == 2)
              {
                st = 6; 
              }
              
							$("#progress-text").append("<span class='col-md-"+st+"'>"+date+"</span>"); //<span class='col-md-3'>2017-08-14</span>
							
						}
            else if(msg_data[i]['stepStatus'] == '2'){
            
              if(steps == 3){
                st = 4; 
              }
              if(steps == 4)
              {
                st = 3; 
              }
              if(steps == 2)
              {
                st = 6; 
              }
              progressdiv.append("<div class='progress-bar progress-bar-warning' style='width: "+width+"%'>"+msg_data[i]['stepDetail']+"</div>");
							//width = width + width; 
					
              $("#progress-text").append("<span class='col-md-"+st+"' >"+date+"</span>"); //<span class='col-md-3'>2017-08-14</span>
             // width++;
						
            }
						else{
						
							progressdiv.append("<div class='progress-bar' style='width: "+width+"%; background-color:inherit !important; color:black; box-shadow: none'>"+msg_data[i]['stepDetail']+"</div>");
              //width--;
						
            }

					}
					
					
					

            }
			
				
				
            });
		$(document).on("click", "#open_popup", function() {
			//alert(dataJSON);
			$("#testForm").empty(); // for empty the alpaca form
			$("#testForm").alpaca({
                            "dataSource": JSON.parse(dataJSON),
                            "optionsSource": JSON.parse(optionsJSON),
                            "schemaSource": JSON.parse(schemaJSON),
                            "options": {
                                "form": {
                                    "buttons": {
                                        "submit": {
											"title": "Close",
											"click": function() {
												 $(".popup, .overlay").hide();
												$("#popup").css("display", "none");
											}
										}										
                                    }
                                }
                            }
                        });
						
			$("#popup").css("display", "block");
			$('.overlay').css({
				'height': $(document).height(),
				'width': $(document).width(),
				'display': 'block'
			});
		});
		
	});

</script>
</body>
</html>
<script>
function displayTime(currentTime) {
    var str = "";
  
    var year = currentTime.getUTCFullYear(); 
    var month = currentTime.getUTCMonth(); 
    var day = currentTime.getUTCDate();
    var hours = currentTime.getHours();
    var minutes = currentTime.getMinutes();
    var seconds = currentTime.getSeconds();
    var week = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
    var mon = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
    var days = week[currentTime.getDay()]; 
    var mth = mon[month]; 
    if (minutes < 10) {
        minutes = "0" + minutes
    }
    if (seconds < 10) {
        seconds = "0" + seconds
    }
    if(hours > 12)
    {
      var hr = hours - 12; 
    }else{
      var hr = hours; 
    }
    str += days + ", "+ mth + " "  + day + ", " + year + "  "+ hr + ":" + minutes + ":" + seconds + " ";
    if(hours > 11){
        str += "PM "
    } else {
        str += "AM "
    }
    return str;
}
// Session manager
maintainSession();
</script>